<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Establish handlers on the stack — with_handlers • rlang</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Establish handlers on the stack — with_handlers" />
<meta property="og:description" content="Condition handlers are functions established on the evaluation
stack (see ctxt_stack()) that are called by R when a condition is
signalled (see cnd_signal() and abort() for two common signal
functions). They come in two types:
Exiting handlers aborts all code currently run between
with_handlers() and the point where the condition has been
raised. with_handlers() passes the return value of the handler
to its caller.
Calling handlers, which are executed from inside the signalling
functions. Their return values are ignored, only their side
effects matters. Valid side effects are writing a log message, or
jumping out of the signalling context by invoking a restart or using return_from(). If the raised
condition was an error, this interrupts the aborting process.
If a calling handler returns normally, it effectively declines to
handle the condition and other handlers on the stack (calling or
exiting) are given a chance to handle the condition.


Handlers are exiting by default, use calling() to create a
calling handler." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-115082821-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-115082821-1');
</script>


  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rlang</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.4.8.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../reference/lifecycle.html">Life cycle</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    News
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Release notes</li>
    <li>
      <a href="https://www.tidyverse.org/blog/2020/02/glue-strings-and-tidy-eval/">Version 0.4.3</a>
    </li>
    <li>
      <a href="https://www.tidyverse.org/articles/2019/06/rlang-0-4-0/">Version 0.4.0</a>
    </li>
    <li>
      <a href="https://www.tidyverse.org/articles/2019/01/rlang-0-3-1/">Version 0.3.1</a>
    </li>
    <li>
      <a href="https://www.tidyverse.org/articles/2018/10/rlang-0-3-0/">Version 0.3.0</a>
    </li>
    <li>
      <a href="https://www.tidyverse.org/articles/2018/03/rlang-0.2.0/">Version 0.2.0</a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="../news/index.html">Change log</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/r-lib/rlang/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Establish handlers on the stack</h1>
    <small class="dont-index">Source: <a href='https://github.com/r-lib/rlang/blob/master/R/cnd-handlers.R'><code>R/cnd-handlers.R</code></a></small>
    <div class="hidden name"><code>with_handlers.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Condition handlers are functions established on the evaluation
stack (see <code><a href='stack.html'>ctxt_stack()</a></code>) that are called by R when a condition is
signalled (see <code><a href='cnd_signal.html'>cnd_signal()</a></code> and <code><a href='abort.html'>abort()</a></code> for two common signal
functions). They come in two types:</p><ul>
<li><p>Exiting handlers aborts all code currently run between
<code>with_handlers()</code> and the point where the condition has been
raised. <code>with_handlers()</code> passes the return value of the handler
to its caller.</p></li>
<li><p>Calling handlers, which are executed from inside the signalling
functions. Their return values are ignored, only their side
effects matters. Valid side effects are writing a log message, or
jumping out of the signalling context by <a href='with_restarts.html'>invoking a restart</a> or using <code><a href='return_from.html'>return_from()</a></code>. If the raised
condition was an error, this interrupts the aborting process.</p>
<p>If a calling handler returns normally, it effectively declines to
handle the condition and other handlers on the stack (calling or
exiting) are given a chance to handle the condition.</p></li>
</ul>

<p>Handlers are exiting by default, use <code>calling()</code> to create a
calling handler.</p>
    </div>

    <pre class="usage"><span class='fu'>with_handlers</span><span class='op'>(</span><span class='va'>.expr</span>, <span class='va'>...</span><span class='op'>)</span>

<span class='fu'>calling</span><span class='op'>(</span><span class='va'>handler</span><span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>.expr</th>
      <td><p>An expression to execute in a context where new
handlers are established. The underscored version takes a quoted
expression or a quoted formula.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>&lt;<a href='dyn-dots.html'>dynamic</a>&gt; Named handlers. These should be
functions of one argument, or <a href='as_function.html'>formula functions</a>.
The handlers are considered exiting by default, use <code>calling()</code>
to specify a calling handler.</p></td>
    </tr>
    <tr>
      <th>handler</th>
      <td><p>A handler function that takes a condition as
argument. This is passed to <code><a href='as_function.html'>as_function()</a></code> and can thus be a
formula describing a lambda function.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="life-cycle"><a class="anchor" href="#life-cycle"></a>Life cycle</h2>

    <p><code><a href='exiting.html'>exiting()</a></code> is soft-deprecated as of rlang
0.4.0 because <code>with_handlers()</code> now treats handlers as exiting by
default.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># Signal a condition with signal():</span>
<span class='va'>fn</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='fu'>g</span><span class='op'>(</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/base/cat.html'>cat</a></span><span class='op'>(</span><span class='st'>"called?\n"</span><span class='op'>)</span>
  <span class='st'>"fn() return value"</span>
<span class='op'>}</span>
<span class='va'>g</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='fu'>h</span><span class='op'>(</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/base/cat.html'>cat</a></span><span class='op'>(</span><span class='st'>"called?\n"</span><span class='op'>)</span>
<span class='op'>}</span>
<span class='va'>h</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='fu'><a href='abort.html'>signal</a></span><span class='op'>(</span><span class='st'>"A foobar condition occurred"</span>, <span class='st'>"foo"</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/base/cat.html'>cat</a></span><span class='op'>(</span><span class='st'>"called?\n"</span><span class='op'>)</span>
<span class='op'>}</span>

<span class='co'># Exiting handlers jump to with_handlers() before being</span>
<span class='co'># executed. Their return value is handed over:</span>
<span class='va'>handler</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>c</span><span class='op'>)</span> <span class='st'>"handler return value"</span>
<span class='fu'>with_handlers</span><span class='op'>(</span><span class='fu'>fn</span><span class='op'>(</span><span class='op'>)</span>, foo <span class='op'>=</span> <span class='va'>handler</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] "handler return value"</div><div class='input'>
<span class='co'># Calling handlers are called in turn and their return value is</span>
<span class='co'># ignored. Returning just means they are declining to take charge of</span>
<span class='co'># the condition. However, they can produce side-effects such as</span>
<span class='co'># displaying a message:</span>
<span class='va'>some_handler</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>c</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/r/base/cat.html'>cat</a></span><span class='op'>(</span><span class='st'>"some handler!\n"</span><span class='op'>)</span>
<span class='va'>other_handler</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>c</span><span class='op'>)</span> <span class='fu'><a href='https://rdrr.io/r/base/cat.html'>cat</a></span><span class='op'>(</span><span class='st'>"other handler!\n"</span><span class='op'>)</span>
<span class='fu'>with_handlers</span><span class='op'>(</span><span class='fu'>fn</span><span class='op'>(</span><span class='op'>)</span>, foo <span class='op'>=</span> <span class='fu'>calling</span><span class='op'>(</span><span class='va'>some_handler</span><span class='op'>)</span>, foo <span class='op'>=</span> <span class='fu'>calling</span><span class='op'>(</span><span class='va'>other_handler</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; some handler!
#&gt; other handler!
#&gt; called?
#&gt; called?
#&gt; called?</div><div class='output co'>#&gt; [1] "fn() return value"</div><div class='input'>
<span class='co'># If a calling handler jumps to an earlier context, it takes</span>
<span class='co'># charge of the condition and no other handler gets a chance to</span>
<span class='co'># deal with it. The canonical way of transferring control is by</span>
<span class='co'># jumping to a restart. See with_restarts() and restarting()</span>
<span class='co'># documentation for more on this:</span>
<span class='va'>exiting_handler</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>c</span><span class='op'>)</span> <span class='fu'><a href='rst_list.html'>rst_jump</a></span><span class='op'>(</span><span class='st'>"rst_foo"</span><span class='op'>)</span>
<span class='va'>fn2</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='fu'><a href='with_restarts.html'>with_restarts</a></span><span class='op'>(</span><span class='fu'>g</span><span class='op'>(</span><span class='op'>)</span>, rst_foo <span class='op'>=</span> <span class='kw'>function</span><span class='op'>(</span><span class='op'>)</span> <span class='st'>"restart value"</span><span class='op'>)</span>
<span class='op'>}</span>
<span class='fu'>with_handlers</span><span class='op'>(</span><span class='fu'>fn2</span><span class='op'>(</span><span class='op'>)</span>, foo <span class='op'>=</span> <span class='fu'>calling</span><span class='op'>(</span><span class='va'>exiting_handler</span><span class='op'>)</span>, foo <span class='op'>=</span> <span class='fu'>calling</span><span class='op'>(</span><span class='va'>other_handler</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] "restart value"</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Lionel Henry, <a href='http://hadley.nz'>Hadley Wickham</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


