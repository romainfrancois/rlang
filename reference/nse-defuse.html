<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Defuse R expressions — nse-defuse • rlang</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Defuse R expressions — nse-defuse" />
<meta property="og:description" content="
The defusing operators expr() and enquo() prevent the
evaluation of R code. Defusing is also known as quoting, and is
done in base R by quote() and substitute(). When a function
argument is defused, R doesn't return its value like it normally
would but it returns the R expression describing how to make the
value. These defused expressions are like blueprints for computing
values.
There are two main ways to defuse expressions, to which correspond
the two functions expr() and enquo(). Whereas expr() defuses
your own expression, enquo() defuses expressions supplied as
argument by the user of a function. See section on function
arguments for more on this distinction.
The main purpose of defusing evaluation of an expression is to
enable data-masking, where an expression is evaluated in the
context of a data frame so that you can write var instead of
data$var. The expression is defused so it can be resumed later
on, in a context where the data-variables have been defined.
Defusing prevents the evaluation of R code, but you can still force
evaluation inside a defused expression with the forcing operators !! and !!!." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-115082821-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-115082821-1');
</script>


  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rlang</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.4.8.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../reference/lifecycle.html">Life cycle</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    News
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Release notes</li>
    <li>
      <a href="https://www.tidyverse.org/blog/2020/02/glue-strings-and-tidy-eval/">Version 0.4.3</a>
    </li>
    <li>
      <a href="https://www.tidyverse.org/articles/2019/06/rlang-0-4-0/">Version 0.4.0</a>
    </li>
    <li>
      <a href="https://www.tidyverse.org/articles/2019/01/rlang-0-3-1/">Version 0.3.1</a>
    </li>
    <li>
      <a href="https://www.tidyverse.org/articles/2018/10/rlang-0-3-0/">Version 0.3.0</a>
    </li>
    <li>
      <a href="https://www.tidyverse.org/articles/2018/03/rlang-0.2.0/">Version 0.2.0</a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="../news/index.html">Change log</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/r-lib/rlang/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Defuse R expressions</h1>
    <small class="dont-index">Source: <a href='https://github.com/r-lib/rlang/blob/master/R/nse-defuse.R'><code>R/nse-defuse.R</code></a></small>
    <div class="hidden name"><code>nse-defuse.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><a href='https://www.tidyverse.org/lifecycle/#stable'><img src='figures/lifecycle-stable.svg' alt='Stable lifecycle'></a></p>
<p>The defusing operators <code>expr()</code> and <code>enquo()</code> prevent the
evaluation of R code. Defusing is also known as <em>quoting</em>, and is
done in base R by <code><a href='https://rdrr.io/r/base/substitute.html'>quote()</a></code> and <code><a href='https://rdrr.io/r/base/substitute.html'>substitute()</a></code>. When a function
argument is defused, R doesn't return its value like it normally
would but it returns the R expression describing how to make the
value. These defused expressions are like blueprints for computing
values.</p>
<p>There are two main ways to defuse expressions, to which correspond
the two functions <code>expr()</code> and <code>enquo()</code>. Whereas <code>expr()</code> defuses
your own expression, <code>enquo()</code> defuses expressions supplied as
argument by the user of a function. See section on function
arguments for more on this distinction.</p>
<p>The main purpose of defusing evaluation of an expression is to
enable data-masking, where an expression is evaluated in the
context of a data frame so that you can write <code>var</code> instead of
<code>data$var</code>. The expression is defused so it can be resumed later
on, in a context where the data-variables have been defined.</p>
<p>Defusing prevents the evaluation of R code, but you can still force
evaluation inside a defused expression with the <a href='nse-force.html'>forcing operators</a> <code>!!</code> and <code>!!!</code>.</p>
    </div>

    <pre class="usage"><span class='fu'>expr</span><span class='op'>(</span><span class='va'>expr</span><span class='op'>)</span>

<span class='fu'>enexpr</span><span class='op'>(</span><span class='va'>arg</span><span class='op'>)</span>

<span class='fu'>exprs</span><span class='op'>(</span>
  <span class='va'>...</span>,
  .named <span class='op'>=</span> <span class='cn'>FALSE</span>,
  .ignore_empty <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"trailing"</span>, <span class='st'>"none"</span>, <span class='st'>"all"</span><span class='op'>)</span>,
  .unquote_names <span class='op'>=</span> <span class='cn'>TRUE</span>
<span class='op'>)</span>

<span class='fu'>enexprs</span><span class='op'>(</span>
  <span class='va'>...</span>,
  .named <span class='op'>=</span> <span class='cn'>FALSE</span>,
  .ignore_empty <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"trailing"</span>, <span class='st'>"none"</span>, <span class='st'>"all"</span><span class='op'>)</span>,
  .unquote_names <span class='op'>=</span> <span class='cn'>TRUE</span>,
  .homonyms <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"keep"</span>, <span class='st'>"first"</span>, <span class='st'>"last"</span>, <span class='st'>"error"</span><span class='op'>)</span>,
  .check_assign <span class='op'>=</span> <span class='cn'>FALSE</span>
<span class='op'>)</span>

<span class='fu'>ensym</span><span class='op'>(</span><span class='va'>arg</span><span class='op'>)</span>

<span class='fu'>ensyms</span><span class='op'>(</span>
  <span class='va'>...</span>,
  .named <span class='op'>=</span> <span class='cn'>FALSE</span>,
  .ignore_empty <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"trailing"</span>, <span class='st'>"none"</span>, <span class='st'>"all"</span><span class='op'>)</span>,
  .unquote_names <span class='op'>=</span> <span class='cn'>TRUE</span>,
  .homonyms <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"keep"</span>, <span class='st'>"first"</span>, <span class='st'>"last"</span>, <span class='st'>"error"</span><span class='op'>)</span>,
  .check_assign <span class='op'>=</span> <span class='cn'>FALSE</span>
<span class='op'>)</span>

<span class='fu'>quo</span><span class='op'>(</span><span class='va'>expr</span><span class='op'>)</span>

<span class='fu'>enquo</span><span class='op'>(</span><span class='va'>arg</span><span class='op'>)</span>

<span class='fu'>quos</span><span class='op'>(</span>
  <span class='va'>...</span>,
  .named <span class='op'>=</span> <span class='cn'>FALSE</span>,
  .ignore_empty <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"trailing"</span>, <span class='st'>"none"</span>, <span class='st'>"all"</span><span class='op'>)</span>,
  .unquote_names <span class='op'>=</span> <span class='cn'>TRUE</span>
<span class='op'>)</span>

<span class='fu'>enquos</span><span class='op'>(</span>
  <span class='va'>...</span>,
  .named <span class='op'>=</span> <span class='cn'>FALSE</span>,
  .ignore_empty <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"trailing"</span>, <span class='st'>"none"</span>, <span class='st'>"all"</span><span class='op'>)</span>,
  .unquote_names <span class='op'>=</span> <span class='cn'>TRUE</span>,
  .homonyms <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"keep"</span>, <span class='st'>"first"</span>, <span class='st'>"last"</span>, <span class='st'>"error"</span><span class='op'>)</span>,
  .check_assign <span class='op'>=</span> <span class='cn'>FALSE</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>expr</th>
      <td><p>An expression.</p></td>
    </tr>
    <tr>
      <th>arg</th>
      <td><p>A symbol representing an argument. The expression
supplied to that argument will be captured instead of being
evaluated.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>For <code>enexprs()</code>, <code>ensyms()</code> and <code>enquos()</code>, names of
arguments to capture without evaluation (including <code>...</code>). For
<code>exprs()</code> and <code>quos()</code>, the expressions to capture unevaluated
(including expressions contained in <code>...</code>).</p></td>
    </tr>
    <tr>
      <th>.named</th>
      <td><p>Whether to ensure all dots are named. Unnamed
elements are processed with <code><a href='as_label.html'>as_label()</a></code> to build a default
name.</p></td>
    </tr>
    <tr>
      <th>.ignore_empty</th>
      <td><p>Whether to ignore empty arguments. Can be one
of <code>"trailing"</code>, <code>"none"</code>, <code>"all"</code>. If <code>"trailing"</code>, only the
last argument is ignored if it is empty. Note that <code>"trailing"</code>
applies only to arguments passed in <code>...</code>, not to named
arguments. On the other hand, <code>"all"</code> also applies to named
arguments.</p></td>
    </tr>
    <tr>
      <th>.unquote_names</th>
      <td><p>Whether to treat <code>:=</code> as <code><a href='https://rdrr.io/r/base/assignOps.html'>=</a></code>. Unlike <code><a href='https://rdrr.io/r/base/assignOps.html'>=</a></code>, the
<code>:=</code> syntax supports <code>!!</code> unquoting on the LHS.</p></td>
    </tr>
    <tr>
      <th>.homonyms</th>
      <td><p>How to treat arguments with the same name. The
default, <code>"keep"</code>, preserves these arguments. Set <code>.homonyms</code> to
<code>"first"</code> to only keep the first occurrences, to <code>"last"</code> to keep
the last occurrences, and to <code>"error"</code> to raise an informative
error and indicate what arguments have duplicated names.</p></td>
    </tr>
    <tr>
      <th>.check_assign</th>
      <td><p>Whether to check for <code>&lt;-</code> calls passed in
dots. When <code>TRUE</code> and a <code>&lt;-</code> call is detected, a warning is
issued to advise users to use <code><a href='https://rdrr.io/r/base/assignOps.html'>=</a></code> if they meant to match a
function parameter, or wrap the <code>&lt;-</code> call in braces otherwise.
This ensures assignments are explicit.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="types-of-defused-expressions"><a class="anchor" href="#types-of-defused-expressions"></a>Types of defused expressions</h2>

    

<ul>
<li><p><strong>Calls</strong>, like <code>f(1, 2, 3)</code> or <code>1 + 1</code> represent the action of
calling a function to compute a new value, such as a vector.</p></li>
<li><p><strong>Symbols</strong>, like <code>x</code> or <code>df</code>, represent named objects. When the
object pointed to by the symbol was defined in a function or in
the global environment, we call it an environment-variable. When
the object is a column in a data frame, we call it a
data-variable.</p></li>
</ul>

<p>You can create new call or symbol objects by using the defusing
function <code>expr()</code>:</p><pre><span class='co'># Create a symbol representing objects called `foo`</span>
<span class='fu'>expr</span><span class='op'>(</span><span class='va'>foo</span><span class='op'>)</span>

<span class='co'># Create a call representing the computation of the mean of `foo`</span>
<span class='fu'>expr</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>foo</span>, na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span>
</pre>

<p>Defusing is not the only way to create defused expressions. You can
also assemble them from data:</p><pre><span class='co'># Assemble a symbol from a string</span>
<span class='va'>var</span> <span class='op'>&lt;-</span> <span class='st'>"foo"</span>
<span class='fu'><a href='sym.html'>sym</a></span><span class='op'>(</span><span class='va'>var</span><span class='op'>)</span>

<span class='co'># Assemble a call from strings, symbols, and other objects</span>
<span class='fu'><a href='https://rdrr.io/r/base/call.html'>call</a></span><span class='op'>(</span><span class='st'>"mean"</span>, <span class='fu'><a href='sym.html'>sym</a></span><span class='op'>(</span><span class='va'>var</span><span class='op'>)</span>, na.rm <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
</pre>

    <h2 class="hasAnchor" id="defusing-function-arguments"><a class="anchor" href="#defusing-function-arguments"></a>Defusing function arguments</h2>

    


<p>There are two points of view when it comes to defusing an
expression:</p><ul>
<li><p>You can defuse expressions that <em>you</em> supply with <code>expr()</code>. This
is one way of creating symbols and calls (see previous section).</p></li>
<li><p>You can defuse the expressions supplied by <em>the user</em> of your
function with the operators starting with <code>en</code> like <code>ensym()</code>,
<code>enquo()</code> and their plural variants. They defuse function
arguments .</p></li>
</ul>

    <h2 class="hasAnchor" id="defused-arguments-and-quosures"><a class="anchor" href="#defused-arguments-and-quosures"></a>Defused arguments and quosures</h2>

    


<p>If you inspect the return values of <code>expr()</code> and <code>enquo()</code>, you'll
notice that the latter doesn't return a raw expression like the
former. Instead it returns a <strong>quosure</strong>, a wrapper containing an
expression and an environment. R needs information about the
environment to properly evaluate the argument expression because it
comes from a different context than the current function.</p>
<p>See the <a href='quosure.html'>quosure</a> help topic about tools to work with quosures.</p>
    <h2 class="hasAnchor" id="comparison-to-base-r"><a class="anchor" href="#comparison-to-base-r"></a>Comparison to base R</h2>

    

<ul>
<li><p>The defusing operator <code>expr()</code> is similar to <code><a href='https://rdrr.io/r/base/substitute.html'>quote()</a></code>. Like
<code><a href='https://rdrr.io/r/base/bquote.html'>bquote()</a></code>, it allows forcing evaluation of parts
of an expression.</p></li>
<li><p>The plural variant <code>exprs()</code> is similar to <code><a href='https://rdrr.io/r/base/list.html'>alist()</a></code>.</p></li>
<li><p>The argument-defusing operator <code>enquo()</code> is similar to
<code><a href='https://rdrr.io/r/base/substitute.html'>substitute()</a></code>.</p></li>
</ul>


    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># expr() and exprs() capture expressions that you supply:</span>
<span class='fu'>expr</span><span class='op'>(</span><span class='va'>symbol</span><span class='op'>)</span>
</div><div class='output co'>#&gt; symbol</div><div class='input'><span class='fu'>exprs</span><span class='op'>(</span><span class='va'>several</span>, <span class='va'>such</span>, <span class='va'>symbols</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [[1]]
#&gt; several
#&gt; 
#&gt; [[2]]
#&gt; such
#&gt; 
#&gt; [[3]]
#&gt; symbols
#&gt; </div><div class='input'>
<span class='co'># enexpr() and enexprs() capture expressions that your user supplied:</span>
<span class='va'>expr_inputs</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>arg</span>, <span class='va'>...</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='va'>user_exprs</span> <span class='op'>&lt;-</span> <span class='fu'>enexprs</span><span class='op'>(</span><span class='va'>arg</span>, <span class='va'>...</span><span class='op'>)</span>
  <span class='va'>user_exprs</span>
<span class='op'>}</span>
<span class='fu'>expr_inputs</span><span class='op'>(</span><span class='va'>hello</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [[1]]
#&gt; hello
#&gt; </div><div class='input'><span class='fu'>expr_inputs</span><span class='op'>(</span><span class='va'>hello</span>, <span class='va'>bonjour</span>, <span class='va'>ciao</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [[1]]
#&gt; hello
#&gt; 
#&gt; [[2]]
#&gt; bonjour
#&gt; 
#&gt; [[3]]
#&gt; ciao
#&gt; </div><div class='input'>
<span class='co'># ensym() and ensyms() provide additional type checking to ensure</span>
<span class='co'># the user calling your function has supplied bare object names:</span>
<span class='va'>sym_inputs</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>...</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='va'>user_symbols</span> <span class='op'>&lt;-</span> <span class='fu'>ensyms</span><span class='op'>(</span><span class='va'>...</span><span class='op'>)</span>
  <span class='va'>user_symbols</span>
<span class='op'>}</span>
<span class='fu'>sym_inputs</span><span class='op'>(</span><span class='va'>hello</span>, <span class='st'>"bonjour"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [[1]]
#&gt; hello
#&gt; 
#&gt; [[2]]
#&gt; bonjour
#&gt; </div><div class='input'><span class='co'>## sym_inputs(say(hello))  # Error: Must supply symbols or strings</span>
<span class='fu'>expr_inputs</span><span class='op'>(</span><span class='fu'>say</span><span class='op'>(</span><span class='va'>hello</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [[1]]
#&gt; say(hello)
#&gt; </div><div class='input'>

<span class='co'># All these quoting functions have quasiquotation support. This</span>
<span class='co'># means that you can unquote (evaluate and inline) part of the</span>
<span class='co'># captured expression:</span>
<span class='va'>what</span> <span class='op'>&lt;-</span> <span class='fu'><a href='sym.html'>sym</a></span><span class='op'>(</span><span class='st'>"bonjour"</span><span class='op'>)</span>
<span class='fu'>expr</span><span class='op'>(</span><span class='fu'>say</span><span class='op'>(</span><span class='va'>what</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; say(what)</div><div class='input'><span class='fu'>expr</span><span class='op'>(</span><span class='fu'>say</span><span class='op'>(</span><span class='op'>!</span><span class='op'>!</span><span class='va'>what</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; say(bonjour)</div><div class='input'>
<span class='co'># This also applies to expressions supplied by the user. This is</span>
<span class='co'># like an escape hatch that allows control over the captured</span>
<span class='co'># expression:</span>
<span class='fu'>expr_inputs</span><span class='op'>(</span><span class='fu'>say</span><span class='op'>(</span><span class='op'>!</span><span class='op'>!</span><span class='va'>what</span><span class='op'>)</span>, <span class='op'>!</span><span class='op'>!</span><span class='va'>what</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [[1]]
#&gt; say(bonjour)
#&gt; 
#&gt; [[2]]
#&gt; bonjour
#&gt; </div><div class='input'>

<span class='co'># Finally, you can capture expressions as quosures. A quosure is an</span>
<span class='co'># object that contains both the expression and its environment:</span>
<span class='va'>quo</span> <span class='op'>&lt;-</span> <span class='fu'>quo</span><span class='op'>(</span><span class='va'>letters</span><span class='op'>)</span>
<span class='va'>quo</span>
</div><div class='output co'>#&gt; <span style='font-weight: bold;'>&lt;quosure&gt;</span><span>
#&gt; expr: </span><span style='color: #0000BB;'>^letters</span><span>
#&gt; env:  </span><span style='color: #0000BB;'>0x7fb99e411d20</span><span></div><div class='input'>
<span class='fu'><a href='set_expr.html'>get_expr</a></span><span class='op'>(</span><span class='va'>quo</span><span class='op'>)</span>
</div><div class='output co'>#&gt; letters</div><div class='input'><span class='fu'><a href='get_env.html'>get_env</a></span><span class='op'>(</span><span class='va'>quo</span><span class='op'>)</span>
</div><div class='output co'>#&gt; &lt;environment: 0x7fb99e411d20&gt;</div><div class='input'>
<span class='co'># Quosures can be evaluated with eval_tidy():</span>
<span class='fu'><a href='eval_tidy.html'>eval_tidy</a></span><span class='op'>(</span><span class='va'>quo</span><span class='op'>)</span>
</div><div class='output co'>#&gt;  [1] "a" "b" "c" "d" "e" "f" "g" "h" "i" "j" "k" "l" "m" "n" "o" "p" "q" "r" "s"
#&gt; [20] "t" "u" "v" "w" "x" "y" "z"</div><div class='input'>
<span class='co'># They have the nice property that you can pass them around from</span>
<span class='co'># context to context (that is, from function to function) and they</span>
<span class='co'># still evaluate in their original environment:</span>
<span class='va'>multiply_expr_by_10</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>expr</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='co'># We capture the user expression and its environment:</span>
  <span class='va'>expr</span> <span class='op'>&lt;-</span> <span class='fu'>enquo</span><span class='op'>(</span><span class='va'>expr</span><span class='op'>)</span>

  <span class='co'># Then create an object that only exists in this function:</span>
  <span class='va'>local_ten</span> <span class='op'>&lt;-</span> <span class='fl'>10</span>

  <span class='co'># Now let's create a multiplication expression that (a) inlines</span>
  <span class='co'># the user expression as LHS (still wrapped in its quosure) and</span>
  <span class='co'># (b) refers to the local object in the RHS:</span>
  <span class='fu'>quo</span><span class='op'>(</span><span class='op'>!</span><span class='op'>!</span><span class='va'>expr</span> <span class='op'>*</span> <span class='va'>local_ten</span><span class='op'>)</span>
<span class='op'>}</span>
<span class='va'>quo</span> <span class='op'>&lt;-</span> <span class='fu'>multiply_expr_by_10</span><span class='op'>(</span><span class='fl'>2</span> <span class='op'>+</span> <span class='fl'>3</span><span class='op'>)</span>

<span class='co'># The local parts of the quosure are printed in colour if your</span>
<span class='co'># terminal is capable of displaying colours:</span>
<span class='va'>quo</span>
</div><div class='output co'>#&gt; </span><span style='font-weight: bold;'>&lt;quosure&gt;</span><span>
#&gt; expr: </span><span style='color: #0000BB;'>^(</span><span style='color: #00BB00;'>^2 + 3</span><span style='color: #0000BB;'>) * local_ten</span><span>
#&gt; env:  </span><span style='color: #0000BB;'>0x7fb99adf6a48</span><span></div><div class='input'>
<span class='co'># All the quosures in the expression evaluate in their original</span>
<span class='co'># context. The local objects are looked up properly and we get the</span>
<span class='co'># expected result:</span>
<span class='fu'><a href='eval_tidy.html'>eval_tidy</a></span><span class='op'>(</span><span class='va'>quo</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] 50</div></span></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Lionel Henry, <a href='http://hadley.nz'>Hadley Wickham</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


